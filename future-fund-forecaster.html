<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personal Savings Planner</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>
<body class="apps-page savings-page">
  <a href="apps.html" class="apps-button back-button">Apps</a>

  <div class="container">
    <h1>Personal Savings Planner</h1>
    <p class="apps-intro" style="text-align:center">Easily compute how much to save each month to reach your personal fund goal by a target date, factoring inflation and expected returns.</p>

    <div class="tax-inputs" role="form" aria-label="Personal Savings Planner">
      <div class="tax-field">
        <label for="goalToday">Goal amount (today's pesos)</label>
        <input id="goalToday" type="number" min="0" step="1000" placeholder="e.g. 2000000" />
      </div>

      <div class="tax-field">
        <label for="targetDate">Target date</label>
        <input id="targetDate" type="date" />
      </div>

      <div class="tax-field">
        <label for="currentSavings">Current Savings (₱)</label>
        <input id="currentSavings" type="number" min="0" step="1000" placeholder="Optional" />
      </div>

      <div class="tax-field">
        <label for="expectedReturn">Expected Annual Return (%)</label>
        <input id="expectedReturn" type="number" min="0" step="0.01" placeholder="e.g. 8" />
      </div>

      <div class="tax-field">
        <label for="inflation">Expected Inflation (%)</label>
        <input id="inflation" type="number" min="0" step="0.01" placeholder="e.g. 4" />
      </div>

      <div class="tax-buttons" style="grid-column: 1 / -1;">
        <button id="calcBtn"><i class="fas fa-chart-line"></i>&nbsp;Calculate</button>
        <button id="resetBtn" style="background:#f1e7da;color:#3b2f2f;border:1px solid #eadfce"><i class="fas fa-rotate-left"></i>&nbsp;Reset</button>
      </div>
    </div>

    <div class="tax-summary" aria-live="polite">
      <h2>Results</h2>
      <ul>
        <li><span>Goal in future pesos:</span> <strong id="goalFuture">—</strong></li>
        <li><span>Months until goal:</span> <strong id="monthsUntil">—</strong></li>
        <li><span>Required monthly savings:</span> <strong id="requiredMonthly">—</strong></li>
        <li><span>Total contributions:</span> <strong id="totalContrib">—</strong></li>
        <li><span>Projected portfolio at target:</span> <strong id="projectedFV">—</strong></li>
      </ul>
    </div>

    <div class="tax-reference" style="margin-top:16px">
      <h2>Yearly Projection</h2>
      <div style="overflow-x:auto">
        <table id="projectionTable">
          <thead>
            <tr>
              <th>Year</th>
              <th>Contributions (₱)</th>
              <th>Growth (₱)</th>
              <th>End Balance (₱)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="4" style="text-align:center;color:#8b6f61">No data yet. Calculate to see the projection.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const goalToday = document.getElementById('goalToday');
      const targetDate = document.getElementById('targetDate');
      const currentSavings = document.getElementById('currentSavings');
      const expectedReturn = document.getElementById('expectedReturn');
      const inflation = document.getElementById('inflation');

      const calcBtn = document.getElementById('calcBtn');
      const resetBtn = document.getElementById('resetBtn');

      const goalFutureEl = document.getElementById('goalFuture');
      const monthsUntilEl = document.getElementById('monthsUntil');
      const requiredMonthlyEl = document.getElementById('requiredMonthly');
      const totalContribEl = document.getElementById('totalContrib');
      const projectedFVEl = document.getElementById('projectedFV');
      const projectionTableBody = document.querySelector('#projectionTable tbody');

      function formatPHP(x){
        if (!isFinite(x)) return '—';
        return new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP', maximumFractionDigits: 2 }).format(x);
      }

      function monthsBetween(now, future){
        const y = future.getFullYear() - now.getFullYear();
        const m = future.getMonth() - now.getMonth();
        const d = future.getDate() - now.getDate();
        let months = y * 12 + m + (d >= 0 ? 0 : -1);
        return Math.max(0, months);
      }

      function validate(){
        const g = parseFloat(goalToday.value);
        const td = targetDate.value ? new Date(targetDate.value) : null;
        const r = parseFloat(expectedReturn.value);
        const inf = parseFloat(inflation.value);
        if (!(g > 0)) return { ok:false, msg:'Enter a valid goal amount in today\'s pesos.' };
        if (!td || isNaN(td.getTime())) return { ok:false, msg:'Choose a valid target date.' };
        if (td <= new Date()) return { ok:false, msg:'Target date must be in the future.' };
        if (!(r >= 0)) return { ok:false, msg:'Enter a valid expected annual return.' };
        if (!(inf >= 0)) return { ok:false, msg:'Enter a valid inflation rate.' };
        return { ok:true };
      }

      function calculate(){
        const v = validate();
        if(!v.ok){ alert(v.msg); return; }

        const now = new Date();
        const td = new Date(targetDate.value);
        const n = monthsBetween(now, td);
        const years = n / 12;

        const goalTodayVal = parseFloat(goalToday.value);
        const current = parseFloat(currentSavings.value || '0');
        const annualReturn = parseFloat(expectedReturn.value) / 100; // nominal
        const infl = parseFloat(inflation.value) / 100;

        // Inflate goal to future pesos
        const goalFuture = goalTodayVal * Math.pow(1 + infl, years);

        // Monthly nominal return
        const i = annualReturn / 12;

        // Future value of current savings
        const fvCurrent = current * Math.pow(1 + i, n);

        // Future value needed from monthly savings
        const fvNeededFromSaving = Math.max(0, goalFuture - fvCurrent);

        // Solve required monthly savings using annuity immediate formula
        let monthly = 0;
        if (i === 0) {
          monthly = fvNeededFromSaving / n;
        } else {
          const factor = (Math.pow(1 + i, n) - 1) / i;
          monthly = fvNeededFromSaving / factor;
        }
        monthly = Math.max(0, monthly);

        // Totals
        const totalContrib = monthly * n + current;
        const projectedFV = fvCurrent + (monthly * ((Math.pow(1 + i, n) - 1) / (i || 1))) ;

        // Output
        goalFutureEl.textContent = formatPHP(goalFuture);
        monthsUntilEl.textContent = String(n);
        requiredMonthlyEl.textContent = formatPHP(monthly);
        totalContribEl.textContent = formatPHP(totalContrib);
        projectedFVEl.textContent = formatPHP(projectedFV);

        // Yearly projection (approximate using annual compounding on balances and 12*monthly contributions)
        const rows = [];
        let balance = current;
        for (let year = 1; year <= Math.ceil(years); year++) {
          const contribThisYear = (year < Math.ceil(years)) ? (monthly * 12) : (monthly * (n - (year - 1) * 12));
          // Apply monthly compounding for the year in a loop to be closer to monthly reality
          let growth = 0;
          let monthsThisYear = (year < Math.ceil(years)) ? 12 : (n - (year - 1) * 12);
          for (let m = 0; m < monthsThisYear; m++) {
            // contribution at month end
            balance *= (1 + i);
            const beforeAdd = balance;
            balance += monthly;
            growth += (beforeAdd - (beforeAdd / (1 + i))); // interest accrued this month
          }
          rows.push({ year, contrib: contribThisYear, growth: balance - (rows.length ? rows[rows.length-1].end : current) - contribThisYear, end: balance });
        }

        projectionTableBody.innerHTML = rows.map(r => `
          <tr>
            <td>${r.year}</td>
            <td>${formatPHP(r.contrib)}</td>
            <td>${formatPHP(Math.max(0, r.growth))}</td>
            <td>${formatPHP(r.end)}</td>
          </tr>
        `).join('');
      }

      function reset(){
        goalToday.value = '';
        targetDate.value = '';
        currentSavings.value = '';
        expectedReturn.value = '';
        inflation.value = '';
        goalFutureEl.textContent = '—';
        monthsUntilEl.textContent = '—';
        requiredMonthlyEl.textContent = '—';
        totalContribEl.textContent = '—';
        projectedFVEl.textContent = '—';
        projectionTableBody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#8b6f61">No data yet. Calculate to see the projection.</td></tr>';
      }

      // Initialize defaults
      (function init(){
        // Set a default target date 5 years from today
        const d = new Date();
        d.setFullYear(d.getFullYear() + 5);
        targetDate.valueAsDate = d;
        expectedReturn.value = 8;
        inflation.value = 4;
      })();

      calcBtn.addEventListener('click', calculate);
      resetBtn.addEventListener('click', reset);
    })();
  </script>
</body>
</html>
