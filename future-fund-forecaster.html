<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personal Savings Planner</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>
<body class="apps-page savings-page">
  <a href="apps.html" class="apps-button back-button">Apps</a>

  <div class="container">
    <h1>Personal Savings Planner</h1>
    <p class="apps-intro" style="text-align:center">Easily compute how much to save each month to reach your personal fund goal by a target date. Choose monthly or yearly projection details.</p>

    <div class="tax-inputs" role="form" aria-label="Personal Savings Planner">
      <div class="tax-field">
        <label for="goalToday">Goal amount (today's pesos)</label>
        <input id="goalToday" type="number" min="0" step="1000" placeholder="e.g. 2000000" />
      </div>

      <div class="tax-field">
        <label for="targetDate">Target date</label>
        <input id="targetDate" type="date" />
      </div>

      <div class="tax-field">
        <label for="currentSavings">Current Savings (₱)</label>
        <input id="currentSavings" type="number" min="0" step="1000" placeholder="Optional" />
      </div>

      <div class="tax-field">
        <label for="projectionDetail">Projection detail</label>
        <select id="projectionDetail">
          <option value="monthly">Monthly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>

      <div class="tax-buttons" style="grid-column: 1 / -1;">
        <button id="calcBtn"><i class="fas fa-chart-line"></i>&nbsp;Calculate</button>
        <button id="resetBtn" style="background:#f1e7da;color:#3b2f2f;border:1px solid #eadfce"><i class="fas fa-rotate-left"></i>&nbsp;Reset</button>
      </div>
    </div>

    <div class="tax-summary" aria-live="polite">
      <h2>Results</h2>
      <ul>
        <li><span>Goal amount:</span> <strong id="goalFuture">—</strong></li>
        <li><span>Months until goal:</span> <strong id="monthsUntil">—</strong></li>
        <li><span>Required monthly savings:</span> <strong id="requiredMonthly">—</strong></li>
        <li><span>Total contributions:</span> <strong id="totalContrib">—</strong></li>
        <li><span>Projected balance at target:</span> <strong id="projectedFV">—</strong></li>
      </ul>
    </div>

    <div class="tax-reference" style="margin-top:16px">
      <h2 id="projectionTitle">Projection</h2>
      <div style="overflow-x:auto">
        <table id="projectionTable">
          <thead id="projectionHead"></thead>
          <tbody id="projectionBody">
            <tr><td style="text-align:center;color:#8b6f61">No data yet. Calculate to see the projection.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const goalToday = document.getElementById('goalToday');
      const targetDate = document.getElementById('targetDate');
      const currentSavings = document.getElementById('currentSavings');
      const projectionDetail = document.getElementById('projectionDetail');

      const calcBtn = document.getElementById('calcBtn');
      const resetBtn = document.getElementById('resetBtn');

      const goalFutureEl = document.getElementById('goalFuture');
      const monthsUntilEl = document.getElementById('monthsUntil');
      const requiredMonthlyEl = document.getElementById('requiredMonthly');
      const totalContribEl = document.getElementById('totalContrib');
      const projectedFVEl = document.getElementById('projectedFV');
      const projectionHead = document.getElementById('projectionHead');
      const projectionBody = document.getElementById('projectionBody');

      function formatPHP(x){
        if (!isFinite(x)) return '—';
        return new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP', maximumFractionDigits: 2 }).format(x);
      }

      function monthsBetween(now, future){
        const y = future.getFullYear() - now.getFullYear();
        const m = future.getMonth() - now.getMonth();
        const d = future.getDate() - now.getDate();
        let months = y * 12 + m + (d >= 0 ? 0 : -1);
        return Math.max(0, months);
      }

      function validate(){
        const g = parseFloat(goalToday.value);
        const td = targetDate.value ? new Date(targetDate.value) : null;
        if (!(g > 0)) return { ok:false, msg:'Enter a valid goal amount in today\'s pesos.' };
        if (!td || isNaN(td.getTime())) return { ok:false, msg:'Choose a valid target date.' };
        if (td <= new Date()) return { ok:false, msg:'Target date must be in the future.' };
        return { ok:true };
      }

      function calculate(){
        const v = validate();
        if(!v.ok){ alert(v.msg); return; }

        const now = new Date();
        const td = new Date(targetDate.value);
        const n = monthsBetween(now, td);
        if (n === 0) { alert('Target date must be at least 1 month from now.'); return; }
        const years = n / 12;

        const goalTodayVal = parseFloat(goalToday.value);
        const current = parseFloat(currentSavings.value || '0');
        // No growth model: simple straight-line savings
        const goalFuture = goalTodayVal;
        const needed = Math.max(0, goalFuture - current);
        const monthly = Math.max(0, needed / n);

        // Totals
        const totalContrib = monthly * n;
        const projectedFV = current + totalContrib;

        // Output
        goalFutureEl.textContent = formatPHP(goalFuture);
        monthsUntilEl.textContent = String(n);
        requiredMonthlyEl.textContent = formatPHP(monthly);
        totalContribEl.textContent = formatPHP(totalContrib);
        projectedFVEl.textContent = formatPHP(projectedFV);

        // Projection (monthly or yearly) without growth
        const granularity = projectionDetail.value;
        let headerHtml = '';
        let bodyHtml = '';
        if (granularity === 'monthly') {
          headerHtml = '<tr><th>Month</th><th>Contribution (₱)</th><th>End Balance (₱)</th></tr>';
          let balance = current;
          for (let m = 1; m <= n; m++) {
            balance += monthly;
            bodyHtml += `<tr><td>${m}</td><td>${formatPHP(monthly)}</td><td>${formatPHP(balance)}</td></tr>`;
          }
          document.getElementById('projectionTitle').textContent = 'Monthly Projection';
        } else {
          headerHtml = '<tr><th>Year</th><th>Contributions (₱)</th><th>End Balance (₱)</th></tr>';
          let balance = current;
          const totalYears = Math.ceil(years);
          for (let y = 1; y <= totalYears; y++) {
            const monthsThisYear = (y < totalYears) ? 12 : (n - (y - 1) * 12);
            const contrib = monthly * monthsThisYear;
            balance += contrib;
            bodyHtml += `<tr><td>${y}</td><td>${formatPHP(contrib)}</td><td>${formatPHP(balance)}</td></tr>`;
          }
          document.getElementById('projectionTitle').textContent = 'Yearly Projection';
        }

        projectionHead.innerHTML = headerHtml;
        projectionBody.innerHTML = bodyHtml;
      }

      function reset(){
        goalToday.value = '';
        targetDate.value = '';
        currentSavings.value = '';
        goalFutureEl.textContent = '—';
        monthsUntilEl.textContent = '—';
        requiredMonthlyEl.textContent = '—';
        totalContribEl.textContent = '—';
        projectedFVEl.textContent = '—';
        projectionHead.innerHTML = '';
        projectionBody.innerHTML = '<tr><td style="text-align:center;color:#8b6f61">No data yet. Calculate to see the projection.</td></tr>';
      }

      // Initialize defaults
      (function init(){
        // Set a default target date 5 years from today
        const d = new Date();
        d.setFullYear(d.getFullYear() + 5);
        targetDate.valueAsDate = d;
        projectionDetail.value = 'monthly';
      })();

      calcBtn.addEventListener('click', calculate);
      resetBtn.addEventListener('click', reset);
      projectionDetail.addEventListener('change', () => { calculate(); });
    })();
  </script>
</body>
</html>
